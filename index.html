<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>CSC Khata Book</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2;padding:10px}
.container{background:#fff;padding:15px;border-radius:8px;max-width:900px;margin:auto}
h2{text-align:center}
input,select,button{width:100%;padding:8px;margin:5px 0}
button{background:#28a745;color:#fff;border:none;font-size:15px;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px;text-align:center;font-size:13px}
th{background:#eee}
.balance{margin:10px 0;font-weight:bold;text-align:center;font-size:16px}
.flex{display:flex;gap:5px}
.red{color:red;font-weight:bold}
.green{color:green;font-weight:bold}
.small-btn{padding:4px 6px;font-size:12px}
</style>
</head>

<body>

<script>
let pass = localStorage.getItem("khata_pass");
if(!pass){
  let p = prompt("‡§®‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§∏‡•á‡§ü ‡§ï‡§∞‡•ã");
  localStorage.setItem("khata_pass",p);
}else{
  let p = prompt("‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§°‡§æ‡§≤‡•ã");
  if(p!==pass){document.body.innerHTML="‚ùå ‡§ó‡§≤‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°"; throw "";}
}
</script>

<div class="container">
<h2>CSC Khata Book</h2>

<input id="name" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ">
<input id="mobile" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
<input id="work" placeholder="‡§ï‡§æ‡§Æ ‡§ï‡§æ ‡§®‡§æ‡§Æ">

<select id="type">
<option value="udhar">‡§â‡§ß‡§æ‡§∞</option>
<option value="cash">‡§®‡§ï‡§¶</option>
</select>

<input id="amount" type="number" placeholder="‡§∞‡§ï‡§Æ">
<input id="date" type="date">
<button onclick="addEntry()">‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>

<hr>

<input id="search" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ñ‡•ã‡§ú‡•á‡§Ç..." onkeyup="show()">

<div class="flex">
<input type="date" id="from">
<input type="date" id="to">
</div>

<div class="flex">
<button onclick="show()">Date Filter</button>
<button onclick="exportPDF()">PDF Export</button>
</div>

<table>
<thead>
<tr>
<th>‡§®‡§æ‡§Æ</th>
<th>‡§ï‡§æ‡§Æ</th>
<th>‡§®‡§ï‡§¶</th>
<th>‡§â‡§ß‡§æ‡§∞</th>
<th>‡§§‡§æ‡§∞‡•Ä‡§ñ</th>
<th>Action</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>

<div class="balance" id="balance">‡§ï‡•Å‡§≤ ‡§¨‡§ï‡§æ‡§Ø‡§æ: ‚Çπ0</div>

<h3>üî¥ ‡§â‡§ß‡§æ‡§∞ ‡§µ‡§æ‡§≤‡•á ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï</h3>
<ul id="udharList"></ul>

</div>

<script>
let data = JSON.parse(localStorage.getItem("khata")) || [];
let editIndex = -1;

function addEntry(){
  let nameVal = document.getElementById("name").value.trim();
  let mobileVal = document.getElementById("mobile").value.trim();
  let workVal = document.getElementById("work").value.trim();
  let typeVal = document.getElementById("type").value;
  let amtVal = Number(document.getElementById("amount").value);
  let dateVal = document.getElementById("date").value || new Date().toISOString().slice(0,10);

  if(nameVal === "" || isNaN(amtVal) || amtVal <= 0){
    alert("‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§∏‡§π‡•Ä ‡§∞‡§ï‡§Æ ‡§°‡§æ‡§≤‡•ã");
    return;
  }

  let obj = {
    name: nameVal,
    mobile: mobileVal,
    work: workVal,
    type: typeVal,
    amount: amtVal,
    date: dateVal
  };

  if(editIndex > -1){
    data[editIndex] = obj;
    editIndex = -1;
  }else{
    data.push(obj);
  }

  localStorage.setItem("khata", JSON.stringify(data));
  clearForm();
  show();
}

function clearForm(){
 name.value=""; mobile.value=""; work.value="";
 amount.value=""; date.value="";
}

function show(){
 let list=document.getElementById("list");
 let ulist=document.getElementById("udharList");
 list.innerHTML=""; ulist.innerHTML="";
 let bal=0;
 let customerBal={};

 let s=search.value.toLowerCase();
 let f=from.value; let t=to.value;

 data.filter(d=>{
  return (!s||d.name.toLowerCase().includes(s)) &&
         (!f||d.date>=f) &&
         (!t||d.date<=t);
 }).forEach((d,i)=>{
  let cash = d.type=="cash"?d.amount:0;
  let udhar = d.type=="udhar"?d.amount:0;
  bal += udhar - cash;

  customerBal[d.name]=(customerBal[d.name]||0)+(udhar-cash);

  list.innerHTML+=`
  <tr>
   <td>${d.name}</td>
   <td>${d.work}</td>
   <td>${cash}</td>
   <td>${udhar}</td>
   <td>${d.date}</td>
   <td>
    <button class="small-btn" onclick="edit(${i})">Edit</button>
    <button class="small-btn" onclick="del(${i})">Del</button>
   </td>
  </tr>`;
 });

 for(let c in customerBal){
   if(customerBal[c]>0){
     ulist.innerHTML+=`<li class="red">${c} : ‚Çπ${customerBal[c]}</li>`;
   }
 }

 document.getElementById("balance").innerHTML=
  "‡§ï‡•Å‡§≤ ‡§¨‡§ï‡§æ‡§Ø‡§æ: ‚Çπ"+bal;
}

function edit(i){
 let d=data[i];
 name.value=d.name; mobile.value=d.mobile;
 work.value=d.work; type.value=d.type;
 amount.value=d.amount; date.value=d.date;
 editIndex=i;
}

function del(i){
 if(confirm("Delete ‡§ï‡§∞‡•á‡§Ç?")){
  data.splice(i,1);
  localStorage.setItem("khata",JSON.stringify(data));
  show();
 }
}

function exportPDF(){
 const { jsPDF } = window.jspdf;
 let pdf=new jsPDF();
 pdf.text("CSC Khata Book",10,10);
 let y=20;
 data.forEach(d=>{
  pdf.text(`${d.name} | ${d.work} | ${d.type=="udhar"?"‡§â‡§ß‡§æ‡§∞":"‡§®‡§ï‡§¶"} ${d.amount} | ${d.date}`,10,y);
  y+=7;
 });
 pdf.save("csc-khata-book.pdf");
}

show();
</script>

</body>
</html>
