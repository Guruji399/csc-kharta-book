<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>CSC Khata Book</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2;padding:10px}
.container{background:#fff;padding:15px;border-radius:8px;max-width:900px;margin:auto}
h2{text-align:center}
input,select,button{width:100%;padding:8px;margin:5px 0}
button{background:#28a745;color:#fff;border:none;font-size:15px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px;text-align:center;font-size:13px}
th{background:#eee}
.balance{margin:10px 0;font-weight:bold;text-align:center}
.flex{display:flex;gap:5px}
.small{font-size:12px}
</style>
</head>

<body>

<div class="container">
<h2>CSC Khata Book</h2>

<input id="name" placeholder="ग्राहक का नाम">
<input id="work" placeholder="काम">
<select id="type">
  <option value="udhar">उधार</option>
  <option value="cash">नकद</option>
</select>
<input id="amount" type="number" placeholder="रकम">
<input id="date" type="date">
<button id="saveBtn">सेव करें</button>

<hr>

<input id="search" placeholder="ग्राहक खोजें">

<div class="flex">
  <input type="date" id="from">
  <input type="date" id="to">
</div>
<button id="filterBtn">Date Filter</button>
<button id="pdfBtn">PDF Export</button>

<table>
<thead>
<tr>
<th>नाम</th>
<th>काम</th>
<th>नकद</th>
<th>उधार</th>
<th>तारीख</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>

<div class="balance" id="balance">कुल बकाया: ₹0</div>
</div>

<script>
let data = JSON.parse(localStorage.getItem("khata_data")) || [];

/* SAVE */
document.getElementById("saveBtn").addEventListener("click", function(){
  let name = document.getElementById("name").value.trim();
  let work = document.getElementById("work").value.trim();
  let type = document.getElementById("type").value;
  let amount = Number(document.getElementById("amount").value);
  let date = document.getElementById("date").value || new Date().toISOString().slice(0,10);

  if(name==="" || isNaN(amount) || amount<=0){
    alert("नाम और सही रकम डालो");
    return;
  }

  data.push({name,work,type,amount,date});
  localStorage.setItem("khata_data", JSON.stringify(data));

  document.getElementById("name").value="";
  document.getElementById("work").value="";
  document.getElementById("amount").value="";
  document.getElementById("date").value="";

  show(data);
});

/* SHOW */
function show(arr){
  let list=document.getElementById("list");
  list.innerHTML="";
  let bal=0;

  arr.forEach(d=>{
    let cash = d.type==="cash" ? d.amount : 0;
    let udhar = d.type==="udhar" ? d.amount : 0;
    bal += udhar - cash;

    list.innerHTML+=`
    <tr>
      <td>${d.name}</td>
      <td>${d.work}</td>
      <td>${cash}</td>
      <td>${udhar}</td>
      <td>${d.date}</td>
    </tr>`;
  });

  document.getElementById("balance").innerText="कुल बकाया: ₹"+bal;
}
show(data);

/* SEARCH */
document.getElementById("search").addEventListener("keyup", function(){
  let s=this.value.toLowerCase();
  let filtered=data.filter(d=>d.name.toLowerCase().includes(s));
  show(filtered);
});

/* DATE FILTER */
document.getElementById("filterBtn").addEventListener("click", function(){
  let f=document.getElementById("from").value;
  let t=document.getElementById("to").value;

  let filtered=data.filter(d=>{
    let dd=new Date(d.date).getTime();
    let fd=f?new Date(f).getTime():null;
    let td=t?new Date(t).getTime():null;
    return (!fd || dd>=fd) && (!td || dd<=td);
  });
  show(filtered);
});

/* PDF */
document.getElementById("pdfBtn").addEventListener("click", function(){
  const { jsPDF } = window.jspdf;
  let pdf=new jsPDF();
  pdf.text("CSC Khata Book",10,10);
  let y=20;
  data.forEach(d=>{
    pdf.text(`${d.name} | ${d.work} | ${d.type} | ${d.amount} | ${d.date}`,10,y);
    y+=7;
  });
  pdf.save("khata-book.pdf");
});
</script>

</body>
</html>
